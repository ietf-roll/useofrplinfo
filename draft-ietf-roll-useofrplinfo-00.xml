<?xml version="1.0"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [

<!ENTITY RFC6550 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6550.xml">
<!ENTITY RFC6553 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6553.xml">
<!ENTITY RFC6554 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6554.xml">
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC7102 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7102.xml">
<!ENTITY I-D.ietf-6lo-routing-dispatch SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-6lo-routing-dispatch.xml">
<!ENTITY I-D.ietf-6tisch-architecture SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-6tisch-architecture.xml"> 

]>

<!--<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?> -->
<!-- used by XSLT processors -->
<!-- For a complete list and description of processing instructions (PIs),
    please see http://xml.resource.org/authoring/README.html. -->
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use.
    (Here they are set differently than their defaults in xml2rfc v1.32) -->
<?rfc strict="no" ?>
<!-- give errors regarding ID-nits and DTD validation -->
<!-- control the table of contents (ToC) -->
<?rfc toc="yes"?>
<!-- generate a ToC -->
<?rfc tocdepth="4"?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<?rfc symrefs="yes"?>
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space
    (using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<!-- end of list of popular I-D processing instructions -->
<rfc category="info" docName="draft-ietf-roll-useofrplinfo-00" ipr="trust200902">
 <!-- category values: std, bcp, info, exp, and historic
    ipr values: trust200902, noModificationTrust200902, noDerivativesTrust200902,
       or pre5378Trust200902
    you can add the attributes updates="NNNN" and obsoletes="NNNN"
    they will automatically be output with "(if approved)" -->

 <!-- ***** FRONT MATTER ***** -->

 <front>
   <!-- The abbreviated title is used in the page header - it is only necessary if the
        full title is longer than 39 characters -->

  <title abbrev="Useof6553">When to use RFC 6553, 6554 and IPv6-in-IPv6</title>

  <author  initials="M.I." surname="Robles" fullname="Maria Ines Robles">
     <organization abbrev="Ericsson">Ericsson</organization>
    <address>
     <postal>
       <street>Hirsalantie 11</street>
       <city>Jorvas</city>
       <code>02420</code>
       <country>Finland</country>
     </postal>
      <email>maria.ines.robles@ericsson.com</email>
    </address>
  </author>

  <author initials="M." surname="Richardson" fullname="Michael C. Richardson">
    <organization abbrev="SSW">Sandelman Software Works</organization>
     <address>
	<postal>
	<street>470 Dawson Avenue</street>
	<city>Ottawa</city>
	<region>ON</region>
	<code>K1Z 5V7</code>
	<country>CA</country>
	</postal>
	<email>mcr+ietf@sandelman.ca</email>
	<uri>http://www.sandelman.ca/</uri>
     </address>

  </author>
  <author initials="P." surname="Thubert" fullname="Pascal Thubert">
    <organization abbrev="Cisco">Cisco Systems, Inc</organization>
     <address>
	<postal>
	<street> Village d'Entreprises Green Side 400, Avenue de Roumanille</street>
	<city>Batiment T3</city>
	<region>Biot - Sophia Antipolis  </region>
	<code>06410</code>
	<country>France</country>
	</postal>
	<email>pthubert@cisco.com </email>
	<uri></uri>
     </address>

  </author>

  <date year="2016" />

   <area>Internet</area>

   <workgroup>ROLL Working Group</workgroup>

   <keyword>RPL Option</keyword>
   <keyword>6LoWPAN</keyword>
   <keyword>RFC 6553</keyword>

   <abstract>
      <t>
	This document states different cases where RFC 6553, RFC 6554 and IPv6-in-IPv6 encapsulation is required to set the
        bases to help defining the compression of RPL routing information in LLN environments.
     </t>
   </abstract>
 </front>

<middle>
  	<section title="Introduction">
	     <t>
		RPL <xref target="RFC6550"/> is a routing protocol for constrained networks. RFC 6553 <xref target="RFC6553"/> defines the "RPL option", carried within the IPv6 Hop-by-Hop header to  			quickly identify inconsistencies in the routing topology. RFC 6554 <xref target="RFC6554"/> defines the "RPL Source Route Header", an IPv6 Extension Header to deliver datagrams within a RPL routing domain.
	    </t>
	    <t>
		Several discussions in the ROLL/6lo/6TiSCH Mailing Lists took place focusing in the definition of how to compress RPL Information in constrained environment.
		ROLL Virtual Interim Meeting (02-2015) concluded that there is a need to define how to use <xref target="RFC6553"/>, <xref target="RFC6554"/> and IPv6-in-IPv6 encapsulation to be able to set the correct environment for compression. <xref target="I-D.ietf-6lo-routing-dispatch">A Routing Header Dispatch for 6LoWPAN (6LoRH)</xref> defines a method to compress RPL Option information and Routing Header type 3 (RFC6554) and an efficient IP-in-IP technique.
	   </t>
        	    <t>
		This document is going to be focused in data plane messages and how can be transmitted within the above mentioned RFCs.
	    </t>
     </section>

     <section title="Terminology and Requirements Language">
        <t>
           The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
           "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   	   document are to be interpreted as described
	   in <xref target="RFC2119">RFC 2119</xref>.
        </t>
        <t>
	Terminology defined in <xref target="RFC7102"/>
        </t>

       </section>


       <section title="Sample/reference topology">
        	<t>
		A RPL network is composed of a 6LBR (6LoWPAN Border Router), Backbone Router (6BBR), 6LR (6LoWPAN Router) and 6LN (6LoWPAN Node) as leaf logically organized in a DODAG structure (Destination Oriented Directed Acyclic Graph).
     		</t>
        	<t>
		RPL defines the RPL Control messages (control plane ), a new ICMPv6 message with Type 155. DIS, DIO and DAO messages are all RPL Control messages but with different Code values.
     		</t>
        	<t>
		RPL supports two modes of Downward traffic: in storing mode, it is fully stateful or an in non-storing, it is fully source routed. A RPL Instance is either fully storing or fully
		non-storing, i.e. a RPL Instance with a combination of storing and non-storing nodes is not supported with the current specifications.
     		</t>
        	<t>
	     <figure title="RPL Stack."

		        anchor="fig_RPLStack" align="center">
		<artwork><![CDATA[
+--------------+
| Upper Layers |
|              |
+--------------+
|   RPL        |
|              |
+--------------+
|   ICMPv6     |
|              |
+--------------+
|   IPv6       |
|              |
+--------------+
|   6LoWPAN    |
|              |
+--------------+
|   PHY-MAC    |
|              |
+--------------+


		]]></artwork></figure>
		 </t>
	       <t>
	     <figure title="A reference RPL Topology." anchor="fig_CommonTopology" align="center">
		<artwork><![CDATA[

                                 +---------+
                             +---+Internet |
                             |   +---------+
                             |
                        +----+--+
                        |DODAG  |
              +---------+Root   +----------+
              |         |6LBR   |          |
              |         +----+--+          |
              |              |             |
              |              |             |
	     ...            ...           ...
              |              |             |
        +-----+-+         +--+---+      +--+---+
        |6LR    |         |      |      |      |
  +-----+       |         |      |      |      |
  |     |       |         |      |      |      +------+
  |     +-----+-+         +-+----+      +-+----+      |
  |           |             |             |           |
  |           |             |             |           |
  |           |             |             |           |
+-+---+     +-+---+      +--+--+       +- --+     +---+-+
|Leaf |     |     |      |     |       |    |     |     |
|6LN  |     |     |      |     |       |    |     |     |
+-----+     +-----+      +-----+       +----+     +-----+

		]]></artwork></figure>
		 </t>
		<t> 
        This document is in part motivated by the work that is ongoing at the         
        6TiSCH working group.                                                         
	     The <xref target="I-D.ietf-6tisch-architecture">6TiSCH architecture           
        </xref> draft explains the network architecture of a 6TiSCH network.
        This architecture is used for the remainder of this document.
        </t>
        <t> The scope of the 6TiSCH Architecture is a Backbone Link that 
        federates multiple LLNs (mesh) as a single IPv6 Multi-Link Subnet.
		  Each LLN in the subnet is anchored at a Backbone Router (6BBR). 
        The Backbone Routers interconnect the LLNs over the Backbone Link and 
        emulate that the LLN nodes are present on the Backbone thus creating a 
        so-called: Multi-Link Subnet. An LLN node can move freely from an LLN 
        anchored at a Backbone Router to another LLN anchored at the same or a 
        different Backbone Router inside the Multi-Link Subnet and conserve its 
        addresses.
	    </t>
		 <t>


<figure anchor='figNetwork'
 title="RPL domain architecture">
<artwork><![CDATA[

               |
            +-----+
            |     | Border Router to the RPL domain
            |     |  (may be a RPL virtual root)
            +-----+
               |
               |          Backbone
         +-------------------+-------------------+
         |                   |                   |
      +-----+             +-----+             +-----+
      |     | Backbone    |     | Backbone    |     | Backbone
      |     | router      |     | router      |     | router
      +|---|+             +-|||-+             +-[_]-+
       |   | PCI-exp       / | \ USB             | Ethernet
      ( ) ( )            ( )( )( )     (6LBR == RPL DODAG root)        
     o o   o  o       o o   o  o  o            o  o   o
     o o   o o  o    o  o   o  o  o  o     o   o  o  o   o  
    o  o o  o o       o   o  o  o  o     6LR == RPL router) o o
    o   o  o  o          o    o  o             z
    o   o o               o  o   o       (6LoWPAN Host)
    
    <----------------------- RPL Instance ------------------------>                

]]></artwork>
</figure>
		 </t>

       </section>


       <section title="Use cases">
         <t>
	   In data plane context a combination of RFC6553, RFC6554 and IPv6-in-IPv6 encapsulation is going to be analyzed for the following traffic flows:

 	 <list>
		 <t>
		   -Flow from RPL-aware-leaf to root
		 </t>
		 <t>
		   -Flow from root to RPL-aware-leaf
		 </t>
		 <t>
		   -Flow from not-RPL-aware-leaf to root
		 </t>
		 <t>
		   -Flow from root to not-RPL-aware-leaf
		 </t>
		 <t>
		   -Flow from RPL-aware-leaf to Internet
		 </t>
		 <t>
		   -Flow from Internet to RPL-aware-leaf
		 </t>
		 <t>
		   -Flow from not-RPL-aware-leaf to Internet
		 </t>
		 <t>
		   -Flow from Internet to not-RPL-aware-leaf
		 </t>
		 <t>
		   -Flow from RPL-aware-leaf to RPL-aware-leaf
		 </t>
		 <t>
		   -Flow from RPL-aware-leaf to not-RPL-aware-leaf
		 </t>
		 <t>
		   -Flow from not-RPL-aware-leaf to RPL-aware-leaf
		 </t>
		 <t>
		   -Flow from not-RPL-aware-leaf to not-RPL-aware-leaf
		 </t>
	  </list>
         </t>   
	  <t>
	  This document assumes a rule that a Header cannot be inserted or
   removed on the fly inside an IPv6 packet that is being routed. 
         </t>   
	  <t>
   
   - This means that an intermediate router that needs to add a header must
   encapsulate the packet in an outer IP header where the new header can be
   placed.
         </t>   
	  <t>
   
   - This also means that a Header can only be removed by an intermediate router 
   if it is placed in an encapsulating IPv6 Header, and in that case, the whole
   encapsulating header must be removed - a replacement may be added.
         </t>   
	  <t>
   
   This document recognizes that some headers such as a Routing Header or a
   Hop-by-Hop header may be modified by routers on the path of the packet
   without the need to add to remove an encapsulating header.
         </t>   
	  <t>
   
   The RPL RH and the RPL option are mutable but recoverable . 
         </t>   
	  <t>
	RPI should be present in every single RPL data packet. There is an exception in non-storing mode, when a packet is going down from the route: the entire route is written, so there are no loops of confusion about which table to use (purpose of instanceID).       
	</t>   
         <t>
	   The applicability for storing (RPL-SN) and non-Storing (RPL-NSN) modes for the previous cases is showed as follows:
         </t>

	 <texttable anchor="table_ex" title="Posibility to transmit in Storing or Non-Storing mode: RPI, RH3, IP-in-IP encapsulation" >
	   <ttcol> Use Case </ttcol>
	   <ttcol> RPL-SN RPI (RFC 6553) </ttcol>
	   <ttcol> RPL-SN RH3 (RFC 6554) </ttcol>
	   <ttcol> RPL-SN IP-in-IP </ttcol>
	   <ttcol> RPL-NSN RPI </ttcol>
	   <ttcol> RPL-NSN RH3 </ttcol>
	   <ttcol> RPL-NSN IP-in-IP </ttcol>
	   <c> RPL-aware-leaf to root</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> No</c>
	   <c> root to RPL-aware-leaf</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> not-RPL-aware-leaf to root</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> root to not-RPL-aware-leaf</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> RPL-aware-leaf to Internet</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Internet to RPL-aware-leaf</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> not-RPL-aware-leaf to Internet</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Internet to not-RPL-aware-leaf</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> RPL-aware-leaf to RPL-aware-leaf</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> RPL-aware-leaf to not-RPL-aware-leaf</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> not-RPL-aware-leaf to RPL-aware-leaf </c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> not-RPL-aware-leaf to not-RPL-aware-leaf</c>
	   <c> Yes</c>
	   <c> No</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	   <c> Yes</c>
	 </texttable>

        </section>


       <section title=" Storing mode">

	       <section title=" Example of Flow from RPL-aware-leaf to root">

			<t>
	 		As states in Section 16.2 of <xref target="RFC6550"/>  a RPL-aware-leaf node does not generally issue DIO messages, a leaf node accepts DIO messages
			(In inconsistency a leaf node generates DIO with infinite rank, to fix it). It may issue DAO and DIS messages though it generally ignores DAO and DIS messages.
			</t>
			<t>
			In storing mode is suitable the use of RFC 6553 to send RPL Information through HBH field checking the routing table to find out where to send the message.
			</t>

		         <t>
			   In this case the flow comprises: 
		
			</t>
			<t>
			RPL-aware-leaf (6LN) --> 6LR --> 6LR,... --> root (6LBR) Note: In this document 6LRs, 6LBR are always full-fledge RPL routers
			</t>
		         <t>
			   The 6LN inserts the RPI header, and send the packet to 6LR which decrement the rank in RPI and send the packet up. When the packet arrives to 6LBR, the RPI is removed and the packet is processed.
		
			</t>
 
			<texttable title="Storing: Summary of the use of headers from RPL-aware-leaf to root">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LN</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <c> Inserted headers</c>
					  <c> RPI</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> RPI </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> RPI </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> --</c>
					  <c> --</c>

			</texttable>
	       </section>

	       <section title=" Example of Flow from root to RPL-aware-leaf">

			 <t>		   
				In this case the flow comprises: 
			</t>
			<t>
		
				root (6LBR)--> 6LR --> RPL-aware-leaf (6LN)  
			</t>
			<t>
		
				In this case the 6LBR insert RPI header and send the packet down, the 6LR is going to increment the rank in RPI (examines instanceID for multiple tables), the packet is processed in 6LN and RPI removed.
			</t>

			<texttable title="Storing: Summary of the use of headers from root to RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LN</ttcol>
					  <c> Inserted headers</c>
					  <c> RPI </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> RPI </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> RPI  </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from root to not-RPL-aware-leaf">
			<t>				
			In this case the flow comprises: 
			</t>
			<t>
		
				root (6LBR)--> 6LR --> not-RPL-aware-leaf (6LN)  
			</t>
			<t>
		
			It includes IPv6-in-IPv6 encapsulation to transmit information not related with the RPL domain. In the 6LBR the RPI header is inserted into an IPv6-in-IPv6 header addressed to the last 6LR, which removes the header before pass the packet to the IPv6 node.
			</t>
			<texttable title="Storing: Summary of the use of headers from root to not-RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> IPv6</ttcol>
					  <c> Inserted headers</c>
					  <c> IPv6-in-IPv6(RPI)</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI)</c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from not-RPL-aware-leaf to root">
			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				not-RPL-aware-leaf (6LN) --> 6LR --> root (6LBR) 
			</t>
			<t>
				When the packet arrives from IPv6 node to 6LR. This router insert the RPI encapsuladed in a IPv6-in-IPv6 header addressed to the root. The root removes the header and process the packet
			</t>

			<texttable title="Storing: Summary of the use of headers from not-RPL-aware-leaf to root">
					  <ttcol> Header</ttcol>
					  <ttcol> IPv6</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c>  IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI)</c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from RPL-aware-leaf to Internet">
			 <t>
			RPL information from RFC 6553 should not go out to Internet. The router should take this information out before send the packet to Internet. The HBH Option is going to be analyzed in each node to the root.
			</t>
			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				RPL-aware-leaf (6LN) --> 6LR --> root (6LBR) --> Internet 
			</t>
			<t> 
			
				6LN insert RPI in a IPv6-in-IPv6 in a outer header, and send the packet to 6LR, which modified the rank in the RPI. When the packet arrives to 6LBR, the RPI is removed.
			</t>

			<texttable title="Storing: Summary of the use of headers from RPL-aware-leaf to Internet">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LN</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> Internet</ttcol>
					  <c> Inserted headers</c>
					  <c> IPv6-in-IPv6(RPI)</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI)</c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c>RPI </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from Internet to RPL-aware-leaf">
			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				Internet --> root (6LBR) --> 6LR --> RPL-aware-leaf (6LN)   
			</t>
			<t>
			
				When the packet arrives from Internet to 6LBR the RPI header is added in a outer IPv6-in-IPv6 header and send to 6LR, which modifies the rank in the RPI. When the packet arrives 6LN the RPI header is removed and the packet processed.
			</t>

			<texttable title="Storing: Summary of the use of headers from Internet to RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> Internet</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LN</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> RPI </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from not-RPL-aware-leaf to Internet">

			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				not-RPL-aware-leaf (6LN) = IPv6 node --> 6LR --> root (6LBR) -->  Internet 
			</t>    
			<t>
			
				In the IPv6 node the flow label is assumed to be zero, the packet is transmited to 6LR which encapsule the RPI header in an outer IPv6-in-IPv6 header and send to 6LBR, which removes this header and send the packet to Internet and might set the flow label field.
			</t>

			<texttable title="Storing: Summary of the use of headers from not-RPL-aware-leaf to Internet">
					  <ttcol> Header</ttcol>
					  <ttcol> IPv6 </ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> Internet</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c>IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> --</c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

		       <section title=" Example of Flow from Internet to non-RPL-aware-leaf">

			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				Internet --> root (6LBR) --> 6LR --> not-RPL-aware-leaf (6LN)    
			</t>    
			<t>
			
				6LBR get the packet from Internet and add a RPI header encapsulated in a IPv6-in-IPv6 header addressed to 6LR and send the packet down. The flow label is set to zero on inner IP. The last 6LR removes the RPI header. The IPv6 node might set the flow label since may arrive with zero value. The 6LBR does not know that the is attached to the last 6LR. The non-RPL-aware-leaf drops packet, because RPI has unknown header 0x63, and 0x63 has “01” = discard packet. If RPI had 0x23, it would “skip”.

			</t>
 
			<texttable title="Storing: Summary of the use of headers from Internet to non-RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> Internet</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> IPv6</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c>  IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c>IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c>-- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from RPL-aware-leaf to RPL-aware-leaf">
	       		<t>
			In <xref target="RFC6550"/> RPL allows a simple one-hop P2P optimization for both storing and non-storing networks.
			A node may send a P2P packet destined to a one-hop neighbor directly to that node. Section 9 in <xref target="RFC6550"/>.
	       		</t>
			<t>
			In this case the flow comprises: 
			</t>
			<t>
			 6LN --> 6LR --> common parent (6LR) --> 6LR -->  6LN
			</t>    
			<t>
			This case is assumed in the same RPL Domain. In the common parent, the direction of RPI is changed (from increasing to decreasing the rank).
			</t> 
			

				<texttable title="Storing: Summary of the use of headers for RPL-aware-leaf to RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LN src</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LR (common parent)</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LN dst</ttcol>
					  <c> Inserted headers</c>
					  <c> RPI </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> RPI</c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> RPI (decreasing rank) </c>
					  <c> RPI (increasing rank)</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from RPL-aware-leaf to non-RPL-aware-leaf">
			<t>
			In this case the flow comprises: 
			</t>
			<t>
			 6LN --> 6LR --> common parent (6LR) --> 6LR -->  not-RPL-aware 6LN
			</t>    
			<t>
			Somehow, the sender has to know that the receiver is not RPL aware, and needs to know 6LR,
	and not even the root knows where the 6LR is (in storing mode).  This case FAILS. This needs to be signaled. Attribute of ::/0 route? Or implicit because destination not matching PIO?
	If in doubt, add IPIP?  IPIP dst = 6LBR (00)

			</t> 
			<texttable title="Storing: Summary of the use of headers from RPL-aware-leaf to not-RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LN</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LR (common parent)</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> IPv6</ttcol>
					  <c> Inserted headers</c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c>IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from not-RPL-aware-leaf to RPL-aware-leaf">

			<t>
			In this case the flow comprises: 
			</t>
			<t>
			 not-RPL-aware 6LN --> 6LR --> common parent (6LR) --> 6LR -->  6LN
			</t>    
			<t>
			The 6LR that get the packet from IPv6 node, insert the RPI header encapsulated in IPv6-in-IPv6 header with destination to 6LN, the common parent change the direction of RPI and finally it is removed by 6LN.
			</t> 
			<texttable title="Storing: Summary of the use of headers from not-RPL-aware-leaf to RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> IPv6</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> common parent (6LR)</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LN</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> --</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from not-RPL-aware-leaf to not-RPL-aware-leaf">

			<t>
			In this case the flow comprises: 
			</t>
			<t>
			 not-RPL-aware 6LN --> 6LR --> root (6LBR) --> 6LR --> not-RPL-aware 6LN
			</t>    
			<t>
			 The problem to solve is how to indicate where to send the packet when get into LLN. Should attributes be added to the border router indicating this?
			</t> 
				<texttable title="Storing: Summary of the use of headers from not-RPL-aware-leaf to not-RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> IPv6 src</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LR (common parent)</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> IPv6 dst</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c>IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c>IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>
       </section>


       <section title="Non Storing mode">

	       <section title=" Example of Flow from RPL-aware-leaf to root">
			 <t>
			In non-storing mode the leaf node uses Hop-By-Hop option (RFC 6553) to indicate the routing information to send messages to the DODAG root,
			this message is going to be analyzed in each node until arrive the DODAG root.
			</t>

		         <t>
			In this case  not need to use IPv6-in-IPv6 because no header is not going to be removed, neither RH3, the flow comprises: 
		
			</t>
			<t>
			RPL-aware-leaf (6LN) --> 6LR --> root (6LBR)
			</t>
			<t> 
			
			This case is the same case as storing mode. 
		         </t>

			<texttable title="Non Storing: Summary of the use of headers from RPL-aware-leaf to root">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LN</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <c> Inserted headers</c>
					  <c> RPI</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> RPI </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> RPI </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>

			</texttable>
	       </section>

	       <section title=" Example of Flow from root to RPL-aware-leaf">

			 <t>		   
				In this case the flow comprises: 
			</t>
			<t>
		
				root (6LBR)--> 6LR --> RPL-aware-leaf (6LN)  
			</t>
			<t>
				6LBR might instert RPI header, and the rute is indicated in RH3. 6LR updated RH3 and 6LN remove these headers.
			
			</t>

			<texttable title="Non Storing: Summary of the use of headers from root to RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LN</ttcol>
					  <c> Inserted headers</c>
					  <c> (optional: RPI), RH3</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> RH3,RPI </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c>RH3 </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from root to not-RPL-aware-leaf">
			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				root (6LBR)--> 6LR --> not-RPL-aware-leaf (IPv6 node)  
			</t>
			<t>
			
				In 6LBR the RH3 is added, and modified in 6LR where is fully consumed, but left there.
				If the RPI is present, the IPv6 node which does not understand it will drop it. To avoid it the RPI should be removed before reach IPv6 node or it is recommended that RPI be omitted. An IPv6-in-IPv6 header should be necessary in this case. The DAO from 6LR about IPv6 could say if that the final IPv6 is not RPL (RPI) capable.
			 </t>

	       		<texttable title=" Non Storing: Summary of the use of headers from root to not-RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> IPv6</ttcol>
					  <c> Inserted headers</c>
					  <c> RH3</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c>RH3</c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from not-RPL-aware-leaf to root">
			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				IPv6-node --> 6LR1 --> 6LR2 --> root (6LBR) 
			</t>
			<t> 
			
				In this case the RPI is encapsulated in the first 6LR, and is not modified in the followings 6LRs. 
			</t>

			<texttable title="Non Storing: Summary of the use of headers from not-RPL-aware-leaf to root">
					  <ttcol> Header</ttcol>
					  <ttcol> IPv6</ttcol>
					  <ttcol> 6LR1</ttcol>
					  <ttcol> 6LR2</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from RPL-aware-leaf to Internet">
			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				RPL-aware-leaf (6LN) --> 6LR --> root (6LBR) --> Internet 
			</t>
			<t> 
			
				This case requires that the network is awareness of what is external to the LLN. Internet node never sees RPI or IPv6-in-IPv6 header. In the 6LBR the flow label is computed if it is zero. RPI remains unmodified.
			</t>

			<texttable title="Non Storing: Summary of the use of headers from RPL-aware-leaf to Internet">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LN</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> Internet</ttcol>
					  <c> Inserted headers</c>
					  <c> IPV6-in-IPv6(RPI)</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPV6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> RPI </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from Internet to RPL-aware-leaf">
			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				Internet --> root (6LBR) --> 6LR --> RPL-aware-leaf (6LN)   
			</t>
			<t>
			
				 If the last RH3 entry is the 6LR, then the IPv6-in-IPv6 will be removed there, if the last entry is the 6LN, then the RH3 will go all the way to the leaf. In 6LBR the flow label should be set to zero.
			</t>

			<texttable title="Non Storing: Summary of the use of headers from Internet to RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> Internet</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LN</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c>  IPv6-in-IPv6(RH3,optional:RPI)  </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6 can be removed if RH3 consumed </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c>  IPv6-in-IPv6(RH3) </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from not-RPL-aware-leaf to Internet">

			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				not-RPL-aware-leaf (6LN) --> 6LR --> root (6LBR) -->  Internet 
			</t>    
			<t>
			
				In this case the flow label is recommended to be zero in the IPv6 node. no RPL headers are added in the IPv6 node, since it is ignorant of RPL. Internet node does not see special headers. In 6LBR the flow label is computed if it is zero.
			</t>

			<texttable title="Non Storing: Summary of the use of headers from not-RPL-aware-leaf to Internet">
					  <ttcol> Header</ttcol>
					  <ttcol> IPv6</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> Internet</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI)</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from Internet to non-RPL-aware-leaf">

			<t>
				In this case the flow comprises: 
			</t>
			<t>
		
				Internet --> root (6LBR) --> 6LR --> not-RPL-aware-leaf (6LN)    
			</t>    
			<t>
			
				In this case the flow label in 6LBR should be set zero in 6LBR, where RH3 is inserted and optionally RHI. RH3 must end at 6LR.

			</t> 
			<t>
				In Non-Storing mode, root knows that the non-RPL-aware-leaf is attached to the parent 6LR, and builds RH3 with IPv6-in-IPv6 with this 6LR as destination.

			</t>

			<texttable title=" NonStoring: Summary of the use of headers from Internet to non-RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> Internet</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> IPv6</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RH3,optional:RPI) </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c>  IPv6-in-IPv6(RH3, RPI) </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from RPL-aware-leaf to RPL-aware-leaf">
			<t>
			In this case the flow comprises: 
			</t>
			<t>
			 6LN --> 6LR --> root (6LBR) --> 6LR -->  6LN
			</t>    
			<t>
			This case comprises in the same RPL Domain. In the 6LN the RPI header is inserted. In the 6LBR the RH3 header is inserted in a IPv6-in-IPv6 header and removed at the 6LN destination.
			</t> 
<t>
			In case of the flow goes from RPL-aware-Leaf to RPL-aware-Leaf, the RPI should be set in a IP-in-IP header, to avoid repetition of RPI header. 
			</t>

				<texttable title="Non Storing: Summary of the use of headers for RPL-aware-leaf to RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LN src</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LN dst</ttcol>
					  <c> Inserted headers</c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c> IPv6-in-IPv6(RH3 to 6LN,RPI) {IP,payload} </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPv6-in-IPv6(RH3,RPI) {IP,RPI,payload} </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
               </section>

	       <section title=" Example of Flow from RPL-aware-leaf to not-RPL-aware-leaf">
			<t>
			In this case the flow comprises: 
			</t>
			<t>
			 6LN --> 6LR --> root (6LBR) --> 6LR -->  not-RPL-aware 6LN
			</t>    
			<t>
			The 6LN insert the RPI in a IPv6-in-IPv6 header, which is addressed to 6LBR. The 6LBR remove this RPI header and insert a RH3 header with an optional RPI. These headers are removed by 6LR before send the packet to the IPv6 node.
			</t> 

		       		<texttable title="Non Storing: Summary of the use of headers from RPL-aware-leaf to not-RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> 6LN</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> IPv6</ttcol>
					  <c> Inserted headers</c>
					  <c> IPv6-in-IPv6(RPI) </c>
					  <c>  IPIP(RH3, opt RPI) </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> IPIP(RPI) </c>
					  <c> IPIP(RH3, opt RPI) </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from not-RPL-aware-leaf to RPL-aware-leaf">

			<t>
			In this case the flow comprises: 
			</t>
			<t>
			 not-RPL-aware 6LN --> 6LR --> root (6LBR) --> 6LR -->  6LN
			</t>    
			<t>
			 RPI is added in 6LR until the root and then removed, then RH3 is added and removed at destination.
			</t> 

				<texttable title="Non Storing: Summary of the use of headers from not-RPL-aware-leaf to RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> IPv6</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LN</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c> IPIP(RPI) </c>
					  <c> IPIP(RH3)</c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> IPIP(RPI) </c>
					  <c> -- </c>
					  <c> IPIP(RH3) </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
	       </section>

	       <section title=" Example of Flow from not-RPL-aware-leaf to not-RPL-aware-leaf">

			<t>
			In this case the flow comprises: 
			</t>
			<t>
			 not-RPL-aware 6LN --> 6LR --> root (6LBR) --> 6LR --> not-RPL-aware 6LN
			</t>    
			<t>
			 RPI is added in 6LR until the root and then might be removed, then RH3 is added. These headers are removed at 6LR before go to destination.
			</t> 
				<texttable title="Non Storing: Summary of the use of headers from not-RPL-aware-leaf to not-RPL-aware-leaf">
					  <ttcol> Header</ttcol>
					  <ttcol> IPv6</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> 6LBR</ttcol>
					  <ttcol> 6LR</ttcol>
					  <ttcol> IPv6</ttcol>
					  <c> Inserted headers</c>
					  <c> -- </c>
					  <c>  IPIP(RPI) </c>
					  <c>  IPIP(RH3) </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Removed headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> IPIP(RPI) </c>
					  <c> IPIP(RH3, opt RPI) </c>
					  <c> -- </c>
					  <c> Re-added headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Modified headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> Untouched headers</c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
					  <c> -- </c>
			</texttable>
       		</section>

       </section>

	<section title="Future RPL work">
	   <t>
	     There are cases from above that are not clear how to send the information. It requires furhter analysis on how to proceed to send the information from source to destination.
	   </t>

	   <t>
	     From the above cases, we have in storing mode:
	   </t>

	   <t>
	     - Flow from RPL-aware-leaf to non-RPL-aware-leaf: Somehow, the sender has to know that the receiver is not RPL aware, and needs to know 6LR,
	and not even the root knows where the 6LR is located.
	   </t>

	   <t>
	     - Flow from not-RPL-aware-leaf to not-RPL-aware-leaf: The problem to solve is how to indicate where to send the packet when get into LLN.
	   </t>
	</section>

	<section title="IANA Considerations">
	   <t>
	      There are no IANA considerations related to this document.
	   </t>
	</section>

	<section anchor="Security" title="Security Considerations">
	   <t>
	 TODO.
	  </t>
	</section>

	<section anchor="Acknowledgments" title="Acknowledgments">
	   <t>
	   This work is partially funded by the FP7 Marie Curie Initial Training
	   Network (ITN) METRICS project (grant agreement No.  607728).
	   </t>
	   <t>
	   The authors would like to acknowledge the review, feedback, and
	   comments of Thomas Watteyne, Xavier Vilajosana and Robert Cragie.</t>
	   <t>
	   To be completed with additional Acknowledgments.
	   </t>

	 </section>


</middle>

 <back>

   <references title="Normative References">


     <!--?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml"?-->

     &RFC6553;
     &RFC6554;
     &RFC2119;
     &RFC6550;
   </references>

   <references title="Informative References">
   <!--?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml"?-->
     &RFC7102;
     &I-D.ietf-6tisch-architecture;
     &I-D.ietf-6lo-routing-dispatch;
   </references>

   <!-- Change Log
v00 2011-03-07  BPa  Initial version

     -->
 </back>
</rfc>
